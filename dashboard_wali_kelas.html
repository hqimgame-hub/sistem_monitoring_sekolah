<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard Wali Kelas</title>

  <!-- Local CSS (Tailwind) -->
  <link rel="stylesheet" href="./style.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <!-- XLSX & jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body class="bg-gray-50 text-gray-800">
  <!-- Main Content controlled by JS -->
  <div id="main-content" class="p-4 mt-16 sm:ml-64 transition-all duration-300">

    <main class="w-full max-w-7xl mx-auto my-6 space-y-6">

      <!-- STATUS BANNER -->
      <div id="statusBanner"
        class="hidden bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 shadow-sm rounded-r-lg flex items-center gap-2 transition-all">
        <i class="bi bi-info-circle-fill text-xl"></i>
        <div class="font-medium">Memuat data...</div>
      </div>

      <!-- FILTERS -->
      <section class="bg-white shadow-md rounded-lg p-6">
        <h5 class="text-gray-700 font-bold mb-4 flex items-center gap-2 border-b border-gray-200 pb-2">
          <i class="bi bi-funnel"></i> Filter Data
        </h5>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
          <div class="hidden"> <!-- Hidden: Wali Kelas fixed class -->
            <label class="block text-sm font-medium text-gray-700 mb-1">Filter Kelas</label>
            <select id="filterKelas"
              class="w-full border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
              <option value="">Semua Kelas</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Filter Siswa</label>
            <select id="filterSiswa"
              class="w-full border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
              <option value="">Semua Siswa</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Dari Tanggal</label>
            <input type="date" id="filterTanggalMulai"
              class="w-full border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm">
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Sampai Tanggal</label>
            <input type="date" id="filterTanggalAkhir"
              class="w-full border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm">
          </div>
        </div>

        <div class="mt-4 flex flex-col md:flex-row gap-3 items-center">
          <div class="flex-1 w-full">
            <input id="inputCari"
              class="w-full border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"
              placeholder="Pencarian cepat: nama, keterangan, jenis pelanggaran...">
          </div>
          <div class="flex flex-wrap gap-2 w-full md:w-auto justify-end">
            <button id="btnRefresh"
              class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg shadow-sm transition-colors text-sm">
              <i class="bi bi-arrow-clockwise"></i> Refresh
            </button>
            <button id="btnExportExcel"
              class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg shadow-sm transition-colors text-sm">
              <i class="bi bi-file-earmark-excel"></i> Excel
            </button>
            <button id="btnExportPDF"
              class="bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg shadow-sm transition-colors text-sm">
              <i class="bi bi-file-earmark-pdf"></i> PDF
            </button>
            <button id="btnPrint"
              class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg shadow-sm transition-colors text-sm">
              <i class="bi bi-printer"></i> Print
            </button>
          </div>
        </div>
      </section>

      <!-- VIEWS CONTAINER -->
      <div id="viewsContainer" class="space-y-6">

        <!-- VIEW: ABSENSI -->
        <div id="viewAbsensi" class="view-section space-y-6">
          <!-- CHARTS ABSENSI -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white shadow-md rounded-lg p-6">
              <h6 class="font-bold text-gray-700 mb-4 border-b pb-2 flex items-center justify-between">
                <span>Rekap Kehadiran</span>
                <span class="text-xs font-normal text-gray-500 bg-gray-100 px-2 py-1 rounded">Update Realtime</span>
              </h6>
              <div class="h-64"><canvas id="chartAbsensi"></canvas></div>
              <div class="mt-4 text-sm text-gray-600 bg-gray-50 p-3 rounded border border-gray-200" id="summaryAbsensi">
              </div>
            </div>
            <div class="bg-white shadow-md rounded-lg p-6">
              <h6 class="font-bold text-gray-700 mb-4 border-b pb-2">Tren Absensi Mingguan</h6>
              <div class="h-64"><canvas id="chartTrenAbsensi"></canvas></div>
            </div>
          </div>

          <!-- TABEL ABSENSI -->
          <section class="bg-white shadow-md rounded-lg overflow-hidden">
            <div class="p-6 border-b border-gray-100 flex items-center justify-between bg-blue-50">
              <h6 class="text-lg font-bold text-blue-800 flex items-center gap-2">
                <i class="bi bi-table"></i> Tabel Absensi
              </h6>
              <span class="text-xs font-medium text-blue-600 bg-blue-100 px-2 py-1 rounded-full">Detail Kehadiran</span>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full text-sm text-left text-gray-600" id="tableAbsensi">
                <thead class="bg-blue-100 text-blue-800 uppercase text-xs font-semibold">
                  <tr>
                    <th class="px-6 py-3 rounded-tl-lg">No</th>
                    <th class="px-6 py-3">Nama</th>
                    <th class="px-6 py-3">Kelas</th>
                    <th class="px-6 py-3 text-center">Status</th>
                    <th class="px-6 py-3">Keterangan</th>
                    <th class="px-6 py-3 rounded-tr-lg">Waktu</th>
                  </tr>
                </thead>
                <tbody id="bodyAbsensi" class="divide-y divide-gray-100 bg-white">
                  <tr>
                    <td colspan="6" class="text-center py-8 text-gray-400 italic">Memuat data...</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="pagAbsensi" class="p-4 border-t border-gray-100 bg-gray-50 flex items-center justify-end"></div>
          </section>
        </div>

        <!-- VIEW: PELANGGARAN -->
        <div id="viewPelanggaran" class="view-section space-y-6 hidden">
          <!-- CHARTS PELANGGARAN -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white shadow-md rounded-lg p-6">
              <h6 class="font-bold text-gray-700 mb-4 border-b pb-2 flex items-center justify-between">
                <span>⚠️ Pelanggaran per Siswa</span>
                <span class="text-xs font-normal text-gray-500 bg-gray-100 px-2 py-1 rounded">Top 5</span>
              </h6>
              <div class="h-64"><canvas id="chartPelanggaran"></canvas></div>
              <div class="mt-4 text-sm text-gray-600 bg-gray-50 p-3 rounded border border-gray-200"
                id="summaryPelanggaran"></div>
            </div>
            <div class="bg-white shadow-md rounded-lg p-6">
              <h6 class="font-bold text-gray-700 mb-4 border-b pb-2">Tren Pelanggaran Mingguan</h6>
              <div class="h-64"><canvas id="chartTrenPelanggaran"></canvas></div>
            </div>
          </div>

          <!-- TABEL PELANGGARAN -->
          <section class="bg-white shadow-md rounded-lg overflow-hidden">
            <div class="p-6 border-b border-gray-100 flex items-center justify-between bg-red-50">
              <h6 class="text-lg font-bold text-red-800 flex items-center gap-2">
                <i class="bi bi-exclamation-triangle"></i> Tabel Pelanggaran
              </h6>
              <span class="text-xs font-medium text-red-600 bg-red-100 px-2 py-1 rounded-full">Catatan
                Kedisiplinan</span>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full text-sm text-left text-gray-600" id="tablePelanggaran">
                <thead class="bg-red-100 text-red-800 uppercase text-xs font-semibold">
                  <tr>
                    <th class="px-6 py-3 rounded-tl-lg">No</th>
                    <th class="px-6 py-3">Nama</th>
                    <th class="px-6 py-3">Kelas</th>
                    <th class="px-6 py-3">Pelanggaran</th>
                    <th class="px-6 py-3 text-center">Poin</th>
                    <th class="px-6 py-3">Keterangan</th>
                    <th class="px-6 py-3 rounded-tr-lg">Tanggal</th>
                  </tr>
                </thead>
                <tbody id="bodyPelanggaran" class="divide-y divide-gray-100 bg-white">
                  <tr>
                    <td colspan="7" class="text-center py-8 text-gray-400 italic">Memuat data...</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div id="pagPelanggaran" class="p-4 border-t border-gray-100 bg-gray-50 flex items-center justify-end">
            </div>
          </section>
        </div>

        <!-- VIEW: CATATAN KELAS -->
        <div id="viewCatatan" class="view-section space-y-6 hidden">
          <section class="bg-white shadow-md rounded-lg overflow-hidden">
            <div class="p-6 border-b border-gray-100 flex items-center justify-between bg-purple-50">
              <h6 class="text-lg font-bold text-purple-800 flex items-center gap-2">
                <i class="bi bi-journal-text"></i> Catatan Kelas (Dari Guru)
              </h6>
              <span class="text-xs font-medium text-purple-600 bg-purple-100 px-2 py-1 rounded-full">Info Akademik &
                Lainnya</span>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full text-sm text-left text-gray-600" id="tableCatatan">
                <thead class="bg-purple-100 text-purple-800 uppercase text-xs font-semibold">
                  <tr>
                    <th class="px-6 py-3 rounded-tl-lg">No</th>
                    <th class="px-6 py-3">Tanggal</th>
                    <th class="px-6 py-3">Guru</th>
                    <th class="px-6 py-3">Catatan</th>
                    <th class="px-6 py-3 rounded-tr-lg">Penting</th>
                  </tr>
                </thead>
                <tbody id="bodyCatatan" class="divide-y divide-gray-100 bg-white">
                  <tr>
                    <td colspan="5" class="text-center py-8 text-gray-400 italic">Memuat data...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>
        </div>

      </div>


      <!-- printable area (for nicer print) -->
      <div id="printArea" class="printable container mt-3"></div>
    </main>

    <!-- Modal Detail Siswa -->
    <div id="modalDetail"
      class="fixed inset-0 z-50 hidden bg-gray-900 bg-opacity-60 backdrop-blur-sm flex items-center justify-center p-4 transition-opacity">
      <div
        class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col transform transition-all scale-100">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4 flex justify-between items-center text-white">
          <h3 id="modalTitle" class="text-lg font-bold flex items-center gap-2">
            <i class="bi bi-person-lines-fill"></i> Detail Siswa
          </h3>
          <button type="button"
            class="text-white hover:bg-white hover:bg-opacity-20 rounded-full w-8 h-8 flex items-center justify-center transition-colors"
            onclick="document.getElementById('modalDetail').classList.add('hidden')">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>

        <!-- Body -->
        <div class="p-6 overflow-y-auto bg-gray-50 flex-1">
          <div id="modalContent" class="space-y-4">
            <!-- Content injected by JS -->
            <div class="flex justify-center py-8">
              <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div class="bg-gray-100 px-6 py-3 flex justify-end">
          <button
            class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-sm transition-colors"
            onclick="document.getElementById('modalDetail').classList.add('hidden')">
            Tutup
          </button>
        </div>
      </div>
    </div>

    <!-- main JS -->
    <script type="module" src="./src/js/dashboard_wali_kelas.js"></script>

    <!-- Bootstrap JS -->
</body>

</html>