<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Kepala Sekolah</title>

  <!-- Local CSS (Tailwind) -->

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Icon -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <script type="module" crossorigin src="/assets/dashboard_kepsek-C_SyIBXY.js"></script>
  <link rel="modulepreload" crossorigin href="/assets/style-Kwe7jDFC.js">
  <link rel="modulepreload" crossorigin href="/assets/firebase_init-IrZITGwD.js">
  <link rel="modulepreload" crossorigin href="/assets/Navbar-z9BVbuuM.js">
  <link rel="modulepreload" crossorigin href="/assets/Sidebar-lRZ-zoN3.js">
  <link rel="modulepreload" crossorigin href="/assets/UI-BpKoNCnT.js">
  <link rel="stylesheet" crossorigin href="/assets/style-BxUjWff2.css">
</head>

<body class="bg-gray-50 text-gray-800">
  <!-- LOADING OVERLAY -->
  <div id="loadingOverlay"
    class="hidden fixed inset-0 bg-gray-900 bg-opacity-60 flex flex-col items-center justify-center text-white text-lg z-50">
    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-500 mb-4"></div>
    <p>Memproses data...</p>
  </div>

  <!-- Main Content controlled by JS -->
  <div id="main-content" class="p-4 pt-24 sm:ml-64 transition-all duration-300">

    <!-- Banner Sinkronisasi -->
    <div id="syncStatus"
      class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6 shadow-sm rounded-r-lg hidden flex items-center gap-2">
      <i class="bi bi-check-circle-fill text-xl"></i>
      <div>âœ… Sinkronisasi berhasil â€” <span id="syncInfo" class="font-medium"></span></div>
    </div>

    <!-- ðŸŽ¯ FILTER BAR: Modern & Clean -->
    <div class="bg-white shadow-md rounded-lg p-6 mb-6">
      <h5 class="text-gray-700 font-bold mb-4 flex items-center gap-2 border-b border-gray-200 pb-2">
        <i class="bi bi-funnel"></i> Filter Data
      </h5>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label>
          <input type="date" id="filterTanggal"
            class="w-full border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Kelas</label>
          <select id="filterKelas"
            class="w-full border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white">
            <option value="">Semua Kelas</option>
          </select>
        </div>
        <div class="flex gap-2">
          <button id="btnFilter"
            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg shadow-sm transition-colors w-full">
            Terapkan
          </button>
        </div>
        <div class="text-right flex flex-col justify-end h-full">
          <span id="statusRealtime" class="text-green-600 text-sm font-semibold flex items-center justify-end gap-1">
            <span class="relative flex h-3 w-3">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
              <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
            </span>
            Realtime Aktif
          </span>
        </div>
      </div>

      <!-- Advanced Filters (Collapsible/Extra) -->
      <div class="mt-4 pt-4 border-t border-gray-100 flex flex-wrap gap-3">
        <button id="btnFilterRentang"
          class="bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-sm flex items-center gap-2 transition-colors">
          <i class="bi bi-calendar-range"></i> Filter Rentang
        </button>
        <button id="btnTampilkanSemua"
          class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-sm flex items-center gap-2 transition-colors">
          <i class="bi bi-list"></i> Tampilkan Semua
        </button>
      </div>

      <!-- Hidden Range Inputs -->
      <div id="rangeInputs"
        class="hidden grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 bg-gray-50 p-4 rounded-lg border border-gray-200">
        <div>
          <label class="block text-xs font-semibold text-gray-500 mb-1">Dari Tanggal</label>
          <input type="date" id="filterDari" class="w-full border-gray-300 rounded text-sm">
        </div>
        <div>
          <label class="block text-xs font-semibold text-gray-500 mb-1">Sampai Tanggal</label>
          <input type="date" id="filterSampai" class="w-full border-gray-300 rounded text-sm">
        </div>
      </div>
    </div>


    <!-- Tab Absensi (Default) -->
    <div id="tabAbsensi" class="space-y-6">

      <!-- Summary Cards -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-white">
        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-md p-4">
          <h6 class="text-blue-100 text-sm font-medium uppercase tracking-wider">Total Siswa</h6>
          <h2 id="totalSiswa" class="text-3xl font-bold mt-1">0</h2>
        </div>
        <!-- More summary cards dynamically? For now keeping static structure cleaner -->
        <div class="md:col-span-3 grid grid-cols-2 md:grid-cols-5 gap-3">
          <div class="bg-white border-l-4 border-green-500 shadow-sm rounded-lg p-3 text-center">
            <h6 class="text-green-600 text-xs uppercase font-bold">Hadir</h6>
            <h4 id="hadirHariIni" class="text-xl font-bold text-gray-800">0</h4>
          </div>
          <div class="bg-white border-l-4 border-yellow-500 shadow-sm rounded-lg p-3 text-center">
            <h6 class="text-yellow-600 text-xs uppercase font-bold">Terlambat</h6>
            <h4 id="terlambatHariIni" class="text-xl font-bold text-gray-800">0</h4>
          </div>
          <div class="bg-white border-l-4 border-cyan-500 shadow-sm rounded-lg p-3 text-center">
            <h6 class="text-cyan-600 text-xs uppercase font-bold">Sakit</h6>
            <h4 id="sakitHariIni" class="text-xl font-bold text-gray-800">0</h4>
          </div>
          <div class="bg-white border-l-4 border-blue-500 shadow-sm rounded-lg p-3 text-center">
            <h6 class="text-blue-600 text-xs uppercase font-bold">Izin</h6>
            <h4 id="izinHariIni" class="text-xl font-bold text-gray-800">0</h4>
          </div>
          <div class="bg-white border-l-4 border-red-500 shadow-sm rounded-lg p-3 text-center">
            <h6 class="text-red-600 text-xs uppercase font-bold">Alfa</h6>
            <h4 id="alfaHariIni" class="text-xl font-bold text-gray-800">0</h4>
          </div>
        </div>
      </div>

      <!-- Charts Area -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Tren Terlambat -->
        <div class="bg-white shadow-md rounded-lg p-6">
          <h6 class="font-bold text-gray-700 mb-4 border-b pb-2">Tren Keterlambatan (7 Hari)</h6>
          <div class="h-64"><canvas id="chartTrenSiswa"></canvas></div>
        </div>

        <!-- Top Kelas Terlambat -->
        <div class="bg-white shadow-md rounded-lg p-6">
          <h6 class="font-bold text-gray-700 mb-4 border-b pb-2">Top 5 Kelas Sering Terlambat</h6>
          <div class="h-64"><canvas id="chartKelasSiswa"></canvas></div>
        </div>
      </div>

      <!-- Top Student Table -->
      <div class="bg-white shadow-md rounded-lg p-6">
        <h6 class="font-bold text-gray-700 mb-4 border-b pb-2">Top 10 Siswa Sering Terlambat</h6>
        <div class="overflow-x-auto">
          <table class="w-full text-sm text-left text-gray-600" id="tabelSiswa">
            <thead class="bg-gray-100 uppercase text-xs">
              <tr>
                <th class="px-4 py-3 rounded-l-lg">#</th>
                <th class="px-4 py-3">Nama</th>
                <th class="px-4 py-3">Kelas</th>
                <th class="px-4 py-3 rounded-r-lg text-center">Jumlah</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Tab Guru -->
    <div id="tabGuru" class="hidden space-y-6">
      <!-- Cards -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-white shadow-md rounded-lg p-4 border-l-4 border-green-500">
          <h6 class="text-gray-500 text-xs uppercase font-bold">Total Guru</h6>
          <h4 id="totalGuru" class="text-2xl font-bold text-green-600 mt-1">0</h4>
        </div>
        <div class="bg-white shadow-md rounded-lg p-4 border-l-4 border-blue-500">
          <h6 class="text-gray-500 text-xs uppercase font-bold">Isi Jurnal Hari Ini</h6>
          <h4 id="guruIsiJurnal" class="text-2xl font-bold text-blue-600 mt-1">0</h4>
        </div>
        <div class="bg-white shadow-md rounded-lg p-4 border-l-4 border-amber-500">
          <h6 class="text-gray-500 text-xs uppercase font-bold">Kepatuhan</h6>
          <h4 id="persenPatuh" class="text-2xl font-bold text-amber-600 mt-1">0%</h4>
        </div>
      </div>

      <div class="bg-white shadow-md rounded-lg p-6">
        <h6 class="font-bold text-gray-700 mb-4 border-b pb-2">Aktivitas Jurnal (7 Hari)</h6>
        <div class="h-64"><canvas id="chartJurnalGuru"></canvas></div>
      </div>

      <div class="bg-white shadow-md rounded-lg p-6">
        <h6 class="font-bold text-gray-700 mb-4 border-b pb-2">Guru Teraktif</h6>
        <div class="overflow-x-auto">
          <table class="w-full text-sm text-left text-gray-600" id="tabelGuru">
            <thead class="bg-blue-50 text-blue-700 uppercase text-xs">
              <tr>
                <th class="px-4 py-3 rounded-l-lg">#</th>
                <th class="px-4 py-3">Nama Guru</th>
                <th class="px-4 py-3 rounded-r-lg">Jumlah Jurnal</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100"></tbody>
          </table>
        </div>
      </div>
    </div>


    <!-- Tab Pelanggaran -->
    <div id="tabPelanggaran" class="hidden space-y-6">
      <!-- Summary Cards -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
        <div class="bg-red-50 p-4 rounded-lg border border-red-100 shadow-sm text-center">
          <h6 class="text-red-500 text-xs font-bold uppercase">Total Pelanggaran</h6>
          <h4 id="totalPelanggaran" class="text-2xl font-bold text-red-700 mt-1">0</h4>
        </div>
        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 shadow-sm text-center">
          <h6 class="text-gray-500 text-xs font-bold uppercase">Kelas Terbanyak</h6>
          <h4 id="kelasTertinggi" class="text-lg font-bold text-gray-800 mt-1 truncate">-</h4>
        </div>
        <div class="bg-sky-50 p-4 rounded-lg border border-sky-100 shadow-sm text-center">
          <h6 class="text-sky-500 text-xs font-bold uppercase">Rata-rata/Kelas</h6>
          <h4 id="rataPelanggaran" class="text-2xl font-bold text-sky-700 mt-1">0</h4>
        </div>
        <div class="bg-amber-50 p-4 rounded-lg border border-amber-100 shadow-sm text-center">
          <h6 class="text-amber-500 text-xs font-bold uppercase">Total Poin</h6>
          <h4 id="totalPoin" class="text-2xl font-bold text-amber-700 mt-1">0</h4>
        </div>
        <div class="bg-purple-50 p-4 rounded-lg border border-purple-100 shadow-sm text-center">
          <h6 class="text-purple-500 text-xs font-bold uppercase">Siswa Terbanyak</h6>
          <h4 id="siswaTertinggi" class="text-lg font-bold text-purple-800 mt-1 truncate">-</h4>
        </div>
      </div>

      <!-- Charts -->
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        <div class="lg:col-span-6 bg-white shadow-md rounded-lg p-6">
          <h6 class="font-bold text-gray-700 mb-4 border-b pb-2">Pelanggaran per Kelas</h6>
          <div class="h-64"><canvas id="chartPelanggaran"></canvas></div>
        </div>
        <div class="lg:col-span-3 bg-white shadow-md rounded-lg p-6">
          <h6 class="font-bold text-gray-700 mb-4 border-b pb-2 flex items-center gap-2">
            <i class="bi bi-pie-chart"></i> Jenis
          </h6>
          <div class="h-64"><canvas id="chartJenisPelanggaran"></canvas></div>
        </div>
        <div class="lg:col-span-3 bg-white shadow-md rounded-lg p-6">
          <h6 class="font-bold text-gray-700 mb-4 border-b pb-2">Tren (30 Hari)</h6>
          <div class="h-64"><canvas id="chartTrendPelanggaran"></canvas></div>
        </div>
      </div>

      <!-- Table -->
      <div class="bg-white shadow-md rounded-lg p-6">
        <h6 class="font-bold text-gray-700 mb-4 border-b pb-2">Riwayat Pelanggaran Terbaru</h6>
        <div class="overflow-x-auto">
          <table class="w-full text-sm text-left text-gray-600" id="tabelPelanggaran">
            <thead class="bg-red-50 text-red-700 uppercase text-xs">
              <tr>
                <th class="px-4 py-3 rounded-l-lg">Nama Siswa</th>
                <th class="px-4 py-3">Kelas</th>
                <th class="px-4 py-3">Jenis</th>
                <th class="px-4 py-3">Kategori</th>
                <th class="px-4 py-3 text-center">Poin</th>
                <th class="px-4 py-3">Tanggal</th>
                <th class="px-4 py-3 rounded-r-lg">Keterangan</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Modal Detail Pelanggaran -->
    <!-- Modal Detail Pelanggaran (Tailwind Version) -->
    <div id="modalPelanggaranDetail" class="hidden fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title"
      role="dialog" aria-modal="true">
      <!-- Backdrop -->
      <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"
        onclick="document.getElementById('modalPelanggaranDetail').classList.add('hidden')"></div>

      <!-- Modal Panel -->
      <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
        <div
          class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl">
          <!-- Header -->
          <div class="bg-gray-50 px-4 py-3 sm:px-6 flex justify-between items-center border-b border-gray-200">
            <h3 class="text-lg font-semibold leading-6 text-gray-900" id="modal-title">
              Detail Pelanggaran â€” <span id="modalTitleKeterangan"></span>
            </h3>
            <button type="button" class="text-gray-400 hover:text-gray-500"
              onclick="document.getElementById('modalPelanggaranDetail').classList.add('hidden')">
              <span class="sr-only">Close</span>
              <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>

          <!-- Body -->
          <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4 max-h-[70vh] overflow-y-auto">
            <div id="modalPelanggaranIsi" class="text-sm text-gray-600">
              Memuat...
            </div>
          </div>

          <!-- Footer -->
          <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 border-t border-gray-200">
            <button type="button"
              class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto"
              onclick="document.getElementById('modalPelanggaranDetail').classList.add('hidden')">
              Tutup
            </button>
          </div>
        </div>
      </div>
    </div>


</body>

</html>